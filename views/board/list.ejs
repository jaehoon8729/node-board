<%- include('../partials/header', { title: '게시판', activePage: 'board' }) %>

<h2 class="mb-4">게시판</h2>

<!-- 검색 폼 -->
<div class="card mb-3">
    <div class="card-body">
        <form action="/board" method="GET" class="row g-3">
            <div class="col-md-3">
                <select name="searchType" class="form-select">
                    <option value="title" <%= searchType === 'title' ? 'selected' : '' %>>제목</option>
                    <option value="content" <%= searchType === 'content' ? 'selected' : '' %>>내용</option>
                    <option value="author" <%= searchType === 'author' ? 'selected' : '' %>>작성자</option>
                </select>
            </div>
            <div class="col-md-7">
                <input type="text" name="search" class="form-control" 
                       placeholder="검색어를 입력하세요" value="<%= search %>">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-search"></i> 검색
                </button>
            </div>
        </form>
    </div>
</div>

<!-- 글쓰기 버튼 -->
<% if (locals.user) { %>
    <div class="text-end mb-3">
        <a href="/board/write" class="btn btn-success">
            <i class="bi bi-pencil-square"></i> 글쓰기
        </a>
    </div>
<% } %>

<!-- 게시글 목록 -->
<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 10%">번호</th>
                        <th style="width: 50%">제목</th>
                        <th style="width: 15%">작성자</th>
                        <th style="width: 15%">작성일</th>
                        <th style="width: 10%">조회수</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (posts.length === 0) { %>
                        <tr>
                            <td colspan="5" class="text-center py-4 text-muted">
                                게시글이 없습니다.
                            </td>
                        </tr>
                    <% } else { %>
                        <% posts.forEach((post, index) => { %>
                            <tr>
                                <td><%= post.id %></td>
                                <td>
                                    <a href="/board/<%= post.id %>" class="text-decoration-none">
                                        <%= post.title %>
                                        <% if (post.file_original_name) { %>
                                            <% 
                                                const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.svg'];
                                                const fileExt = post.file_original_name.toLowerCase().substring(post.file_original_name.lastIndexOf('.'));
                                                const isImage = imageExtensions.includes(fileExt);
                                            %>
                                            <% if (isImage) { %>
                                                <i class="bi bi-image text-success ms-1" title="이미지 첨부"></i>
                                            <% } else { %>
                                                <i class="bi bi-paperclip text-primary ms-1" title="파일 첨부"></i>
                                            <% } %>
                                        <% } %>
                                    </a>
                                </td>
                                <td><%= post.user.username %></td>
                                <td><%= new Date(post.created_at).toLocaleDateString() %></td>
                                <td><%= post.views %></td>
                            </tr>
                        <% }); %>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 페이지네이션 -->
<% if (totalPages > 1) { %>
    <nav class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                <a class="page-link" href="?page=<%= currentPage - 1 %>&search=<%= search %>&searchType=<%= searchType %>">
                    이전
                </a>
            </li>
            
            <% for (let i = 1; i <= totalPages; i++) { %>
                <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                    <a class="page-link" href="?page=<%= i %>&search=<%= search %>&searchType=<%= searchType %>">
                        <%= i %>
                    </a>
                </li>
            <% } %>
            
            <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                <a class="page-link" href="?page=<%= currentPage + 1 %>&search=<%= search %>&searchType=<%= searchType %>">
                    다음
                </a>
            </li>
        </ul>
    </nav>
<% } %>

<%- include('../partials/footer') %>
